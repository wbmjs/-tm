name: ðŸ”„ è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹è®¢é˜…

on:
  # æ¯å¤© UTC 00:00 è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´ 08:00ï¼‰
  schedule:
    - cron: '0 0 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  update-gist:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›Žï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ðŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ðŸ“¦ å®‰è£…ä¾èµ–
        run: |
          pip install -r requirements.txt

      - name: ðŸŒ èŽ·å–æœ€æ–°èŠ‚ç‚¹
        id: fetch
        run: |
          python fetch_nodes.py > nodes.txt
        env:
          INVITE_CODE: ${{ secrets.INVITE_CODE }}

      - name: ðŸ“¤ æ›´æ–°åˆ° Gist
        uses: exuanbo/actions-gist@v1.1.0
        with:
          token: ${{ secrets.GIST_TOKEN }}
          gist_id: ${{ secrets.GIST_ID }}
          files: |
            {
              "nodes.txt": {
                "content": "${{ readFile('nodes.txt') }}"
              }
            }
        continue-on-error: false
