name: ðŸ”„ è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹è®¢é˜…

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update-gist:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›Žï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ðŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: ðŸ“¦ å®‰è£…ä¾èµ–
        run: |
          if [ ! -f "requirements.txt" ]; then
            pip install requests>=2.31.0
          else
            pip install -r requirements.txt
          fi

      - name: ðŸŒ èŽ·å–æœ€æ–°èŠ‚ç‚¹
        id: fetch
        run: |
          # ç›´æŽ¥å°†è„šæœ¬è¾“å‡ºå†™å…¥æ–‡ä»¶ï¼Œä¸é€šè¿‡çŽ¯å¢ƒå˜é‡ä¼ é€’
          python fetch_nodes.py > nodes.txt 2>&1
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦éžç©º
          if [ -s nodes.txt ]; then
            echo "FILE_NOT_EMPTY=true" >> $GITHUB_ENV
          fi
        env:
          INVITE_CODE: ${{ secrets.INVITE_CODE }}
        continue-on-error: true

      - name: ðŸ“¤ æ›´æ–°åˆ° Gist
        if: env.FILE_NOT_EMPTY == 'true'
        uses: exuanbo/actions-deploy-gist@v1.1.0
        with:
          token: ${{ secrets.GIST_TOKEN }}
          gist_id: ${{ secrets.GIST_ID }}
          file_path: ./nodes.txt
          gist_file_name: nodes.txt
        continue-on-error: false
